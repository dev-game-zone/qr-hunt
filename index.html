<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Scavenger Hunt ‚Äì Access</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles/styles.css">
  <link rel="icon" type="image/png" href="./favicon.png">
</head>

<body class="home"> <!-- apply a page class like other pages -->
<!-- Detective Lottie Animation -->
<div id="detective-animation"></div>

<!-- Lottie Player -->
<script src="https://unpkg.com/lottie-web/build/player/lottie.min.js"></script>

<script>
  lottie.loadAnimation({
    container: document.getElementById('detective-animation'),
    renderer: 'svg',
    loop: true,
    autoplay: true,
    path: '/qr-hunt/pages/images/detective_search.json'
  });
</script>

<main>
  <h2>Enter Today‚Äôs Access Code</h2>
  <p>Please enter the daily access code to begin the scavenger hunt.</p>

  <!-- match registration layout: inputs grouped + buttons inside .button-group -->
  <div class="admin-input-row" style="max-width:400px; margin:0 auto;">
    <input id="code" type="text" placeholder="Access Code" autocomplete="off" autofocus>
  </div>

  <div class="button-group">
    <button id="enter">Enter</button>
  </div>

  <p id="msg"></p>
</main>

<!-- üß© Safe fallback: define sha256 if app.js hasn't loaded yet -->
<script>
if (typeof sha256 === "undefined") {
  async function sha256(text) {
    const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(text));
    return Array.from(new Uint8Array(buf))
      .map(b => b.toString(16).padStart(2, "0"))
      .join("")
      .toUpperCase();
  }
  console.log("‚öôÔ∏è sha256 fallback loaded");
}
</script>

<!-- Scripts -->
<script src="scripts/config.js"></script>
<script src="scripts/app.js"></script>

<script>
window.addEventListener("DOMContentLoaded", () => {
  const codeInput = document.getElementById("code");
  const msg = document.getElementById("msg");
  const enterBtn = document.getElementById("enter");

  if (sessionStorage.getItem("access") === "granted") {
    window.location.href = "pages/game/game.html";
    return;
  }

  enterBtn.onclick = async () => {
    try {
      const code = codeInput.value.trim();
      const ok = await verifyAccessCode(code);
      if (ok) {
        sessionStorage.setItem("access", "granted");
        window.location.href = "pages/game/game.html";
      } else {
        msg.textContent = "‚ùå Incorrect code. Try again.";
      }
    } catch (err) {
      console.error(err);
      msg.textContent = "‚ö†Ô∏è There was a problem verifying the code.";
    }
  };
});
</script>

</body>
</html>
