<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Scavenger Hunt ‚Äì Access</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles/styles.css">
  <link rel="icon" type="image/png" href="./favicon.png">
  <style>
    /* Show typed input in uppercase but keep placeholder in Camel Case */
    #code { text-transform: uppercase; }
    #code::placeholder { text-transform: none; color: #999; }
  </style>
</head>

<body class="home">

  <!-- Detective Lottie Animation -->
  <div id="detective-animation"></div>

  <!-- Lottie Player -->
  <script src="https://unpkg.com/lottie-web/build/player/lottie.min.js"></script>
  <script>
    const detective = document.getElementById('detective-animation');
    lottie.loadAnimation({
      container: detective,
      renderer: 'svg',
      loop: true,
      autoplay: true,
      path: 'pages/images/detective_search.json'
    });

    // Mobile-friendly scaling
    const detectiveWidth = Math.min(120, window.innerWidth * 0.15); // 15% of viewport width max
    detective.style.width = detectiveWidth + 'px';
    detective.style.height = detectiveWidth + 'px';

    const speed = window.innerWidth * 0.02; // px/frame speed proportional to screen width
    let direction = -1; // -1 = right-to-left start
    let x = -detectiveWidth;

    const minY = window.innerHeight * 0.55;
    const maxY = window.innerHeight * 0.7;
    let y = minY + Math.random() * (maxY - minY);

    detective.style.position = 'fixed';
    detective.style.top = `${y}px`;
    detective.style.left = `${x}px`;
    detective.style.transform = 'rotateY(180deg)'; // face right initially

    function animate() {
      const delta = speed / 100; // approximate px/frame
      x += delta * direction;
      detective.style.left = `${x}px`;

      // subtle vertical sway
      const sway = Math.sin(x / 50) * 5; // ¬±5px up/down
      detective.style.top = `${y + sway}px`;

      // Offscreen ‚Üí teleport & randomize y with slight lean
      if (direction === 1 && x > window.innerWidth) {
        direction = -1;
        x = window.innerWidth; // teleport offscreen right
        y = minY + Math.random() * (maxY - minY);
        detective.style.top = `${y}px`;
        detective.style.transform = 'rotateY(0deg) rotateZ(-5deg)'; // face left
      }

      if (direction === -1 && x < -detectiveWidth) {
        direction = 1;
        x = -detectiveWidth; // teleport offscreen left
        y = minY + Math.random() * (maxY - minY);
        detective.style.top = `${y}px`;
        detective.style.transform = 'rotateY(180deg) rotateZ(5deg)'; // face right
      }

      requestAnimationFrame(animate);
    }

    requestAnimationFrame(animate);

    // Optional: adjust on resize
    window.addEventListener('resize', () => {
      const newWidth = Math.min(120, window.innerWidth * 0.15);
      detective.style.width = newWidth + 'px';
      detective.style.height = newWidth + 'px';
    });
  </script>


  <main>
    <h2>Enter Today‚Äôs Access Code</h2>
    <p>Please enter the daily access code to begin the scavenger hunt.</p>

    <div class="admin-input-row" style="max-width:400px; margin:0 auto;">
      <input id="code" type="text" placeholder="Access Code" autocomplete="off" autofocus>
    </div>

    <div class="button-group">
      <button id="enter">Enter</button>
    </div>

    <p id="msg"></p>
  </main>

  <!-- üß© SHA256 fallback -->
  <script>
    if (typeof sha256 === "undefined") {
      async function sha256(text) {
        const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(text));
        return Array.from(new Uint8Array(buf))
          .map(b => b.toString(16).padStart(2, "0"))
          .join("")
          .toUpperCase();
      }
      console.log("‚öôÔ∏è sha256 fallback loaded");
    }
  </script>

  <!-- App Scripts -->
  <script src="scripts/config.js"></script>
  <script src="scripts/app.js"></script>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const codeInput = document.getElementById("code");
      const msg = document.getElementById("msg");
      const enterBtn = document.getElementById("enter");

      if (sessionStorage.getItem("access") === "granted") {
        window.location.href = "pages/game/game.html";
        return;
      }

      enterBtn.onclick = async () => {
        try {
          const code = codeInput.value.trim();
          const ok = await verifyAccessCode(code);
          if (ok) {
            sessionStorage.setItem("access", "granted");
            window.location.href = "pages/game/game.html";
          } else {
            msg.textContent = "‚ùå Incorrect code. Try again.";
          }
        } catch (err) {
          console.error(err);
          msg.textContent = "‚ö†Ô∏è There was a problem verifying the code.";
        }
      };
    });
  </script>

</body>
</html>
